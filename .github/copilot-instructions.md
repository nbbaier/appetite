# Appetite Development Instructions

Always follow these instructions first and fallback to additional search and context gathering only if the information here is incomplete or found to be in error.

## Working Effectively

### System Requirements

### Prerequisites
- **Node.js**: Version 20+ required (tested with 20.19.4)
- **npm**: Version 10+ (tested with 10.8.2)
- **Operating System**: Linux, macOS, or Windows with WSL
- **Memory**: 2GB+ available for development
- **Docker**: Required only for local Supabase development (optional)

### Browser Support
- **Development**: Modern browsers with ES2020 support
- **Target**: Chrome 90+, Firefox 88+, Safari 14+, Edge 90+
- **Features Used**: ES modules, fetch API, CSS Grid, Flexbox

## Bootstrap and Build Process
- **Fresh Clone Setup**:
  ```bash
  git clone <repository>
  cd appetite
  cp .env.example .env
  npm install    # 20 seconds, NEVER CANCEL
  npm run build  # 5 seconds, NEVER CANCEL
  npm run dev    # 200ms startup, NEVER CANCEL
  ```
- **Validation**: Navigate to http://localhost:5173/ to verify landing page loads
- **Dependencies**: 501 packages installed, 7 known vulnerabilities (non-blocking)

### Build System Details
- **Bundler**: Vite 5.4.8 with React plugin
- **Target**: ES2020 with modern browser support
- **Output**: Optimized chunks with code splitting by route
- **Assets**: Images, fonts, and static files served from `public/`
- **Hot Reload**: Automatic with Vite dev server

### Development Server  
- Run development server: `npm run dev` -- starts in 200ms, serves on http://localhost:5173/
- NEVER CANCEL the dev server, it starts immediately
- Run production preview: `npm run preview` -- serves built app on http://localhost:4173/

### Testing
- Run all tests: `npm run test` -- takes 15 seconds, NEVER CANCEL
  - **Expected Results**: 14 test files pass, 4 files fail (acceptable - missing React context providers)  
  - **Test Summary**: 68 tests pass, 13 tests fail out of 81 total tests
  - **Passing Tests**: Utility functions, notification service, some context tests
  - **Failing Tests**: Components requiring multiple context providers (AuthContext + SettingsContext)
- Run specific test file: `npm run test -- src/lib/utils.test.ts` -- takes 2 seconds
- Run tests in watch mode: `npm run test:watch`  
- Run test coverage: `npm run test:coverage`
- **Test Framework**: Vitest + React Testing Library + jsdom environment
- **Test Files**: 18 test files located alongside source files (*.test.tsx, *.test.ts)

#### Test Writing Patterns
When writing tests for components that use contexts:
- Mock dependencies properly using vi.mock()
- Wrap components in required providers (AuthProvider, SettingsProvider, etc.)
- Use `// @ts-nocheck` and biome-ignore comments for test-specific patterns
- Example working test: `src/lib/utils.test.ts`, `src/lib/notificationService.test.ts`
- Example failing pattern: Tests missing SettingsProvider wrapper

### Code Quality
- Lint code: `npm run lint` -- takes 0.3 seconds, uses Biome (NOT ESLint)
- Format code: `npm run format` -- takes 0.7 seconds, formats 125 files
- Check all (lint + format): `npm run check` -- takes 4 seconds  
- Auto-fix issues: `npm run check:fix` -- takes 0.8 seconds, fixes format issues automatically
- ALWAYS run `npm run check:fix` before committing to ensure code quality

## Application Architecture

### Tech Stack
- **Frontend**: React 18 + TypeScript + Vite
- **Styling**: Tailwind CSS + PostCSS
- **Testing**: Vitest + React Testing Library + jsdom
- **Linting**: Biome (configured in `biome.json`)
- **Backend**: Supabase (PostgreSQL + Auth + Edge Functions)
- **Deployment**: Netlify (configured in `netlify.toml`)

### Key Directories
- `src/` - Main application source code
  - `components/` - React components organized by feature
  - `contexts/` - React context providers (Auth, Recipe, Pantry, Settings, etc.)
  - `pages/` - Route components for each major page
  - `lib/` - Utility functions and service layers
  - `types/` - TypeScript type definitions
  - `hooks/` - Custom React hooks
- `supabase/` - Database migrations and configuration
- `public/` - Static assets
- `dist/` - Built application (generated by `npm run build`)

## Application Architecture

### Tech Stack
- **Frontend Framework**: React 18 with TypeScript and JSX transform
- **Build Tool**: Vite 5.4.8 with plugins for React and optimized bundling
- **Styling**: Tailwind CSS 3.4+ with PostCSS and custom design system
- **Component Library**: Radix UI primitives with shadcn/ui patterns
- **Icons**: Lucide React for consistent iconography
- **Forms**: React Hook Form with Zod validation schemas
- **Testing**: Vitest + React Testing Library + jsdom environment
- **Linting/Formatting**: Biome 2.0.6 (replaces ESLint/Prettier)
- **Backend**: Supabase (PostgreSQL + Auth + Edge Functions + Storage)
- **AI Integration**: OpenAI GPT-4.1 through Supabase Edge Functions
- **Deployment**: Netlify with automatic deployments

### Application Domain Model
**Appetite** is a comprehensive recipe management and food waste reduction application with these core domains:

#### User Management & Authentication
- User registration and login with Supabase Auth
- Profile management with dietary preferences and restrictions
- Kitchen equipment tracking for recipe compatibility
- Cooking skill level for AI personalization

#### Pantry & Inventory Management  
- Ingredient tracking with quantities, units, and categories
- Expiration date monitoring with customizable alert thresholds
- Low stock alerts with threshold management
- Smart categorization with AI-powered suggestions
- Bulk ingredient management and search/filtering

#### Recipe Discovery & Management
- Recipe browsing with filtering by difficulty, cuisine, and availability
- "Can Cook" functionality showing recipes with available ingredients
- Recipe bookmarking and personal collections
- Detailed recipe views with ingredients, instructions, and nutrition info
- Smart shopping list integration (excludes owned ingredients)

#### Shopping List Management
- Multiple shopping list support with item categorization
- Purchase tracking with visual progress indicators
- Smart recipe integration for automated list generation
- Category-based organization for efficient shopping
- Automatic pantry updates when items marked as purchased

#### AI-Powered Assistant
- Real-time chat with OpenAI GPT-4.1 integration
- Context-aware responses using pantry data and user preferences
- Recipe recommendations based on available ingredients
- Dietary restriction and allergy-safe suggestions
- Cooking skill level appropriate guidance and tips

## Development Workflow

### Environment Setup
- Copy environment template: `cp .env.example .env`
- **Application works WITHOUT Supabase configuration** for UI/frontend development
- For full functionality, configure Supabase in `.env`:
  ```
  VITE_SUPABASE_URL=https://your-project-id.supabase.co
  VITE_SUPABASE_ANON_KEY=your-anon-key
  ```
- **Graceful Fallback**: App uses mock Supabase client when environment variables not set
- **No Internet Required**: All UI development and testing can be done offline

### Local Supabase Development (Optional)
- **Requirements**: Docker installed and running
- **Limitations**: Current `supabase/config.toml` has configuration issues with CLI version 1.212.0
- **Alternative**: Use cloud Supabase instance for database development
- **For Supabase CLI**: Install with official Supabase CLI installation guide
- **Database Migrations**: 20+ migration files in `supabase/migrations/` define complete schema

### Local Development
- Start development: `npm run dev`
- Application loads at http://localhost:5173/ showing landing page
- Without Supabase: Authentication shows "Failed to fetch" (expected behavior)
- With Supabase: Full authentication and database functionality available
- Hot module replacement works automatically with Vite

### Database Development (Supabase)
- Local Supabase requires Docker and proper configuration
- Database schema in `supabase/migrations/` (20+ migration files)
- Configuration in `supabase/config.toml`
- Note: Local Supabase setup has configuration complexities - refer to Supabase CLI docs

## Validation Scenarios

### Manual Testing Requirements  
After making changes, ALWAYS test these core user scenarios:

#### Basic Application Flow (No Supabase Required)
1. Clone repository and setup: `git clone <repo> && cd <repo> && cp .env.example .env`
2. Install and build: `npm install && npm run build` -- takes 25 seconds total
3. Start dev server: `npm run dev` -- starts in 200ms  
4. Navigate to http://localhost:5173/ -- verify landing page loads correctly
5. Click "Get Started" → verify navigation to signup page with form fields
6. Fill signup form (any test data) → verify shows "Failed to fetch" error (expected behavior without Supabase)
7. Click "Already have an account? Sign in" → verify navigation to signin page
8. Verify no React errors in browser console (Supabase fetch errors are expected)

#### Full Application Flow (With Supabase Configuration)
**Prerequisites**: Valid Supabase project with URL and anon key in `.env`
1. Start dev server: `npm run dev`
2. Complete signup process → should create account and redirect to dashboard  
3. Test protected route navigation: Dashboard → Pantry → Recipes → Shopping → Assistant → Settings
4. Add pantry item → verify it appears in pantry list with real-time updates
5. Search recipes → verify recipe cards display with "Can Cook" functionality  
6. Test AI assistant chat → verify OpenAI responses work correctly
7. Create shopping list → verify CRUD operations work
8. Test expiration alerts → verify dashboard shows upcoming expiration notifications

#### Build and Deployment Validation
1. Clean build: `rm -rf dist && npm run build` -- takes 5 seconds, NEVER CANCEL
2. Preview build: `npm run preview` -- serves on http://localhost:4173/
3. Test all routes work in preview mode (/, /signup, /signin, /dashboard, etc.)
4. Verify no console errors in production build
5. Check bundle sizes are reasonable (main bundle ~470KB gzipped to ~137KB)

## Code Quality Requirements

### Before Committing
- ALWAYS run: `npm run check:fix` -- auto-fixes formatting and linting issues
- ALWAYS run: `npm run test` -- ensure tests still pass
- ALWAYS run: `npm run build` -- ensure production build works

## Development Best Practices

### Component Development
- Follow existing component patterns in `src/components/`
- Use TypeScript interfaces from `src/types/index.ts`
- Implement proper error boundaries and loading states
- Use Tailwind CSS classes following existing design system
- Follow React 18 patterns with hooks and functional components

### State Management Patterns
- Use React Context for global state (see `src/contexts/`)
- Implement proper provider hierarchies in `App.tsx`
- Handle loading and error states consistently
- Use custom hooks for complex logic isolation
- Follow established service layer patterns in `src/lib/`

### Database Integration
- All database operations go through `src/lib/database.ts`
- Use proper TypeScript types for Supabase operations
- Implement Row Level Security (RLS) policies when adding new tables
- Follow existing migration patterns in `supabase/migrations/`
- Test with both real and mock Supabase clients

### Code Quality Standards
- **Always run before committing**: `npm run check:fix && npm run test && npm run build`
- Use Biome for all linting and formatting (configured in `biome.json`)
- Follow strict TypeScript configuration
- Implement proper error handling with `src/lib/errorUtils.ts`
- Use consistent naming: PascalCase for components, camelCase for functions

### Performance Guidelines
- Leverage Vite's code splitting for route-based chunks
- Use React.lazy() for large components (see existing patterns in `App.tsx`)
- Implement proper loading states for async operations
- Optimize bundle sizes using Vite's built-in optimizations
- Monitor performance with browser dev tools during development

## Important Files and Locations

### Frequently Modified Files
- `src/App.tsx` - Main application router and provider hierarchy
- `src/components/` - Feature-specific React components organized by domain
  - `auth/` - Authentication forms and flows
  - `recipes/` - Recipe cards, modals, and management
  - `pantry/` - Ingredient management and tracking
  - `shopping/` - Shopping list components
  - `ui/` - Reusable UI components (buttons, inputs, etc.)
- `src/contexts/` - State management via React Context
  - `AuthContext.tsx` - User authentication and session management
  - `RecipeContext.tsx` - Recipe data and operations  
  - `PantryContext.tsx` - Pantry inventory management
  - `SettingsContext.tsx` - Application and user preferences
- `src/lib/database.ts` - Supabase service layer with all CRUD operations
- `src/lib/supabase.ts` - Supabase client configuration with mock fallback
- `src/types/index.ts` - Comprehensive TypeScript type definitions
- `package.json` - Dependencies and build scripts

### Configuration Files
- `vite.config.ts` - Vite build configuration
- `vitest.config.ts` - Test environment configuration (jsdom)
- `biome.json` - Comprehensive linting and formatting rules (NOT ESLint)
- `tailwind.config.js` - Tailwind CSS configuration with custom colors
- `tsconfig.json` - TypeScript configuration (references `tsconfig.app.json`, `tsconfig.node.json`)
- `netlify.toml` - Deployment configuration for production
- `supabase/config.toml` - Supabase local development configuration

### Key Context Providers (Critical for Testing)
Always wrap components requiring these contexts properly:
- `AuthProvider` - User authentication state (required for most components)
- `SettingsProvider` - Application and user settings (required for alerts, preferences)
- `PantryProvider` - Pantry item management state
- `RecipeProvider` - Recipe data and operations
- `NotificationProvider` - Toast notifications and error handling

### Database Schema (Supabase)
Key tables and relationships (see `supabase/migrations/`):
- `users` - User profiles and authentication
- `ingredients` - Pantry inventory with expiration tracking
- `recipes` - Recipe metadata and details
- `recipe_ingredients` - Recipe ingredient relationships
- `recipe_instructions` - Step-by-step cooking instructions
- `shopping_lists` - Shopping list management
- `bookmarks` - User recipe bookmarks
- `user_preferences` - Settings and dietary restrictions

## Common Troubleshooting

### Test Failures
- **Expected Test State**: 68/81 tests pass (13 failures due to context provider setup)
- **Failing Tests**: Components requiring AuthProvider + SettingsProvider wrappers
- **Working Tests**: Utility functions (`src/lib/utils.test.ts`), service layers (`src/lib/notificationService.test.ts`)
- **Test Pattern Issues**: Some tests missing `React` import (use `// @ts-nocheck` if needed)
- **Provider Setup**: Wrap test components in required context providers:
  ```tsx
  render(
    <AuthProvider>
      <SettingsProvider>
        <ComponentUnderTest />
      </SettingsProvider>
    </AuthProvider>
  );
  ```

### Build Issues
- If build fails, check TypeScript errors first with `npm run build`
- Ensure all imports are correctly typed and exported
- Run `npm run check:fix` to resolve linting/formatting issues automatically
- Clear build cache: `rm -rf dist node_modules && npm install && npm run build`

### Development Server Issues  
- If dev server won't start, check port 5173 availability
- Kill existing processes: `pkill -f "vite"`
- Clear Vite cache: `rm -rf node_modules/.vite`
- If dependency issues: `rm -rf node_modules package-lock.json && npm install`

### Supabase Connection Issues
- **Without Supabase**: Application works with mock client, shows fetch errors (expected)
- **With Invalid Config**: Check VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY in `.env`  
- **CORS Errors**: Verify Supabase project allows localhost:5173 in auth settings
- **Database Errors**: Check Supabase project is active and migrations are applied

### Code Quality Issues
- **Biome Warnings**: Run `npm run check:fix` to auto-resolve most issues
- **TypeScript Errors**: Check imports and ensure all types are properly exported
- **React Warnings**: Verify useEffect dependencies and key props are correct
- **Console Errors**: Check browser dev tools for runtime errors

## Build Times and Performance

## Build Times and Performance

### Command Timing Expectations (NEVER CANCEL)
- `npm install`: **20 seconds** - Installs 501 packages, always succeeds
- `npm run build`: **5 seconds** - Creates production build in `dist/`, NEVER CANCEL
- `npm run test`: **15 seconds** - Runs 81 tests across 18 files, NEVER CANCEL  
- `npm run lint`: **0.3 seconds** - Biome linting with warnings
- `npm run format`: **0.7 seconds** - Formats 125 files automatically
- `npm run check`: **4 seconds** - Combined lint + format check
- `npm run check:fix`: **0.8 seconds** - Auto-fixes all fixable issues
- `npm run dev` startup: **0.2 seconds** - Vite dev server ready immediately

### Performance Characteristics
- **Development Server**: Hot reload in <100ms for most changes
- **Build Output**: 
  - Total bundle size: ~470KB main bundle (gzipped to ~137KB)
  - Code splitting: Separate chunks for each route and major feature
  - Largest chunk: Assistant page (~130KB for AI integration)
  - CSS bundle: ~43KB (gzipped to ~8KB)
- **Test Performance**: Complete test suite runs in 15 seconds consistently
- **Code Quality**: Biome checks 125 files in <1 second

### Resource Usage
- **Memory**: Development server uses ~200MB RAM
- **Build Process**: Peak ~500MB RAM during TypeScript compilation
- **Network**: No external dependencies required for basic development
- **Storage**: `node_modules` ~150MB, `dist` build ~2MB

## Task Master Integration

This project uses Task Master AI for comprehensive project management and development workflows.

### Task Master Key Files  
- `.taskmaster/tasks/tasks.json` - Main task database (auto-managed, DO NOT edit manually)
- `.taskmaster/config.json` - AI model configuration
- `CLAUDE.md` - Complete Task Master context for Claude Code integration  
- `AGENTS.md` - Agent integration guide and workflow patterns
- `PLAN.md` - Comprehensive project roadmap and development phases

### Task Master Development Workflow
- View current tasks: `task-master list`
- Get next available task: `task-master next`  
- View task details: `task-master show <id>` (e.g., `task-master show 1.2`)
- Mark task complete: `task-master set-status --id=<id> --status=done`
- Break down complex tasks: `task-master expand --id=<id> --research --force`
- Update task during development: `task-master update-subtask --id=<id> --prompt="implementation notes"`

### Project Development Context
- **Current Phase**: Phase 9 Complete - Advanced Ingredient Management
- **Next Priority**: Phase 10 - Intelligent Leftover Tracking  
- **Completed Features**: Authentication, pantry management, recipe discovery, shopping lists, AI assistant
- **In Progress**: Advanced AI personalization and leftover tracking system

### Development Patterns
- Always reference `PLAN.md` for current project status and feature roadmap
- Use Task Master for tracking implementation progress and dependencies
- Follow established patterns in existing components for consistency
- Check `src/contexts/` for state management patterns before adding new global state